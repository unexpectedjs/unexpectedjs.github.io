
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0">
    <link rel="stylesheet" href="../../static/normalize.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../static/main.css" type="text/css" media="screen" />
    <link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../static/bug-icon-black.ico">
    <title>addAssertion</title>
</head>
<body class="sidebar-hidden has-sidebar">
    <header>
        <div class="logo-icon"></div>
        <nav>
            <ul>
                <li class="menu-toggle-item">
                    <button class="menu-toggle" onclick="toggleSidebar()"></button>
                </li>
                
                <li class=""><a href="../../">Unexpected</a></li>
                
                
                <li class=""><a href="../../assertions/any/to-be/">Assertions</a></li>
                
                
                <li class="active"><a href="./">API</a></li>
                
                
                <li class=""><a href="../../plugins/">Plugins</a></li>
                
            </ul>
        </nav>
        <div class="search" style="visibility: hidden">
            <input id="search" placeholder="Search..." value="">
            <div id="searchDropDown" class="dropDown">
                <ul id="searchResults"></ul>
            </div>
        </div>
    </header>

<section id="api">
    <nav id="api-menu" class="sidebar js-remember-scroll-position">
    <ul>
        
        <li class="active">
            <a href="./">addAssertion</a>
        </li>
        
        <li class="">
            <a href="../addStyle/">addStyle</a>
        </li>
        
        <li class="">
            <a href="../addType/">addType</a>
        </li>
        
        <li class="">
            <a href="../child/">child</a>
        </li>
        
        <li class="">
            <a href="../clone/">clone</a>
        </li>
        
        <li class="">
            <a href="../expect/">expect</a>
        </li>
        
        <li class="">
            <a href="../fail/">fail</a>
        </li>
        
        <li class="">
            <a href="../freeze/">freeze</a>
        </li>
        
        <li class="">
            <a href="../installTheme/">installTheme</a>
        </li>
        
        <li class="">
            <a href="../promise/">promise</a>
        </li>
        
        <li class="">
            <a href="../promise-all/">promise.all</a>
        </li>
        
        <li class="">
            <a href="../promise-any/">promise.any</a>
        </li>
        
        <li class="">
            <a href="../promise-settle/">promise.settle</a>
        </li>
        
        <li class="">
            <a href="../shift/">shift</a>
        </li>
        
        <li class="">
            <a href="../toString/">toString</a>
        </li>
        
        <li class="">
            <a href="../UnexpectedError/">UnexpectedError</a>
        </li>
        
        <li class="">
            <a href="../use/">use</a>
        </li>
        
        <li class="">
            <a href="../withError/">withError</a>
        </li>
        
    </ul>
</nav>

    <div class="main" tabindex="-1">
        <div class="content">
            <h1 id="expect-addassertion-">expect.addAssertion(...)</h1>
<p>Signature:</p>
<pre class="code lang-javascript"><div>expect<span style="color: #000000">.</span><span style="color: #000000">addAssertion</span><span style="color: #000000">(</span>pattern<span style="color: #000000">,</span>&nbsp;handler<span style="color: #000000">);</span></div><div>expect<span style="color: #000000">.</span><span style="color: #000000">addAssertion</span><span style="color: #000000">([</span>pattern<span style="color: #000000">,</span>&nbsp;<span style="color: #a71d5d">...</span><span style="color: #000000">],</span>&nbsp;handler<span style="color: #000000">);</span></div></pre>

<p><code>expect.addAssertion</code> takes two arguments:</p>
<ol>
<li>a string pattern (or an array of patterns) that describes the assertion.</li>
<li>a handler function that is called when the assertion is invoked.</li>
</ol>
<p>For example:</p>
<pre class="code lang-javascript"><div>expect<span style="color: #000000">.</span><span style="color: #000000">addAssertion</span><span style="color: #000000">(</span><span style="color: #df5000">'&lt;array&gt;&nbsp;to&nbsp;have&nbsp;item&nbsp;&lt;any&gt;'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span></div><div>&nbsp;&nbsp;expect<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;subject<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;value</div><div><span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span>subject<span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'to&nbsp;contain'</span><span style="color: #000000">,</span>&nbsp;value<span style="color: #000000">);</span></div><div><span style="color: #000000">});</span></div></pre>

<p>A handler function can use other assertions, including other custom assertions
previously added via <code>expect.addAssertion</code>. This way, one could build up complex assertions from simpler ones or just reword an existing assertion, like in this example.</p>
<p>The new assertion can then be used as follows:</p>
<pre class="code lang-javascript"><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;have&nbsp;item'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">);</span></div></pre>

<p>The first parameter to <code>addAssertion</code> is a string or an array of strings
describing the pattern(s) the assertion should match. The pattern takes the
following structure:</p>
<p><code>&lt;subject type&gt; an assertion string &lt;value type&gt;</code></p>
<p>The words in angle brackets define what types the assertion applies to. These
can be any of the internally-defined types or new types added via
<a href="../addType">expect.addType</a>. In this example, the subject to <code>to have item</code>
must be an array, while the value may be of any type.</p>
<p>If mismatching types are used when an assertion is invoked, Unexpected throws an
error with a helpful suggestion:</p>
<pre class="code lang-javascript"><div><span style="color: #000000">expect</span><span style="color: #000000">(</span><span style="color: #df5000">'abcd'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'to&nbsp;have&nbsp;item'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'a'</span><span style="color: #000000">);</span></div></pre>

<pre class="output"><div><span style="color: red; font-weight: bold">expected</span>&nbsp;<span style="color: #df5000">'abcd'</span>&nbsp;<span style="color: red; font-weight: bold">to&nbsp;have&nbsp;item</span>&nbsp;<span style="color: #df5000">'a'</span></div><div>&nbsp;&nbsp;<span style="color: red; font-weight: bold">The&nbsp;assertion&nbsp;does&nbsp;not&nbsp;have&nbsp;a&nbsp;matching&nbsp;signature&nbsp;for:</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&lt;string&gt;&nbsp;to&nbsp;have&nbsp;item&nbsp;&lt;string&gt;</div><div>&nbsp;&nbsp;did&nbsp;you&nbsp;mean:</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&lt;array&gt;&nbsp;to&nbsp;have&nbsp;item&nbsp;&lt;any&gt;</div></pre>

<p>An assertion may only have one <code>&lt;subject type&gt;</code> definition, followed by the
desired assertion string, followed by zero or more <code>&lt;value type&gt;</code> definitions.
It&#39;s not possible to add words between the value-type definitions. For instance,
an assertion such as <code>&lt;number&gt; to be between &lt;number&gt; and &lt;number&gt;</code> could
instead be written as:</p>
<pre class="code lang-javascript"><div>expect<span style="color: #000000">.</span><span style="color: #000000">addAssertion</span><span style="color: #000000">(</span><span style="color: #df5000">'&lt;number&gt;&nbsp;to&nbsp;be&nbsp;between&nbsp;&lt;number&gt;&nbsp;&lt;number&gt;'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span></div><div>&nbsp;&nbsp;expect<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;subject<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;value1<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;value2</div><div><span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span>subject<span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'to&nbsp;be&nbsp;greater&nbsp;than'</span><span style="color: #000000">,</span>&nbsp;value1<span style="color: #000000">).</span><span style="color: #000000">and</span><span style="color: #000000">(</span><span style="color: #df5000">'to&nbsp;be&nbsp;less&nbsp;than'</span><span style="color: #000000">,</span>&nbsp;value2<span style="color: #000000">);</span></div><div><span style="color: #000000">});</span></div><div>&nbsp;</div><div><span style="color: #000000">expect</span><span style="color: #000000">(</span><span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'to&nbsp;be&nbsp;between'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">);</span></div></pre>

<p>Assertions that support specific subject or value types can be defined by
separating the permissible types with a <code>|</code> character.</p>
<p>We use this to redefine our earlier &quot;to have item&quot; assertion - doing so
makes the assertion more strict, only allowing number and string values
but not boolean values, for example:</p>
<pre class="code lang-javascript"><div>expect<span style="color: #000000">.</span><span style="color: #000000">addAssertion</span><span style="color: #000000">(</span><span style="color: #df5000">'&lt;array&gt;&nbsp;to&nbsp;have&nbsp;item&nbsp;&lt;number|string&gt;'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span></div><div>&nbsp;&nbsp;expect<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;subject<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;value</div><div><span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span>subject<span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'to&nbsp;contain'</span><span style="color: #000000">,</span>&nbsp;value<span style="color: #000000">);</span></div><div><span style="color: #000000">});</span></div><div>&nbsp;</div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;have&nbsp;item'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">);</span></div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #df5000">'a'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'b'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'c'</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;have&nbsp;item'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'a'</span><span style="color: #000000">);</span></div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">true</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">false</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;have&nbsp;item'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">true</span><span style="color: #000000">);</span></div></pre>

<pre class="output">&nbsp;</pre>

<h2 id="alternations">Alternations</h2>
<p>Different versions of the same assertion, or different assertions that share the
same handler function, can be added using an array:</p>
<pre class="code lang-javascript"><div>expect<span style="color: #000000">.</span><span style="color: #000000">addAssertion</span><span style="color: #000000">(</span></div><div>&nbsp;&nbsp;<span style="color: #000000">[</span><span style="color: #df5000">'&lt;array&gt;&nbsp;to&nbsp;have&nbsp;item&nbsp;&lt;any&gt;'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'&lt;array&gt;&nbsp;to&nbsp;have&nbsp;value&nbsp;&lt;any&gt;'</span><span style="color: #000000">],</span></div><div>&nbsp;&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span>expect<span style="color: #000000">,</span>&nbsp;subject<span style="color: #000000">,</span>&nbsp;value<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span>subject<span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'to&nbsp;contain'</span><span style="color: #000000">,</span>&nbsp;value<span style="color: #000000">);</span></div><div>&nbsp;&nbsp;<span style="color: #000000">}</span></div><div><span style="color: #000000">);</span></div><div>&nbsp;</div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;have&nbsp;item'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">);</span></div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;have&nbsp;value'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">);</span></div></pre>

<p>However, when it&#39;s a small deviation, as in this case, an alternation is more
handy:</p>
<pre class="code lang-javascript"><div>expect<span style="color: #000000">.</span><span style="color: #000000">addAssertion</span><span style="color: #000000">(</span><span style="color: #df5000">'&lt;array&gt;&nbsp;to&nbsp;have&nbsp;(item|value)&nbsp;&lt;any&gt;'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span></div><div>&nbsp;&nbsp;expect<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;subject<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;value</div><div><span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span>subject<span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'to&nbsp;contain'</span><span style="color: #000000">,</span>&nbsp;value<span style="color: #000000">);</span></div><div><span style="color: #000000">});</span></div><div>&nbsp;</div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;have&nbsp;item'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">);</span></div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;have&nbsp;value'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">);</span></div></pre>

<p>Alternations allow branching, similar to an <code>if..else</code> statement. They are made
available to the handler function as an <code>expect.alternations</code> array which
contains the word used when the assertion is invoked:</p>
<pre class="code lang-javascript"><div>expect<span style="color: #000000">.</span><span style="color: #000000">addAssertion</span><span style="color: #000000">(</span><span style="color: #df5000">'&lt;array&gt;&nbsp;to&nbsp;have&nbsp;(index|value)&nbsp;&lt;any&gt;'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span></div><div>&nbsp;&nbsp;expect<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;subject<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;value</div><div><span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;<span style="color: #a71d5d">if</span>&nbsp;<span style="color: #000000">(</span>expect<span style="color: #000000">.</span>alternations<span style="color: #000000">[</span><span style="color: #0086b3">0</span><span style="color: #000000">]</span>&nbsp;<span style="color: #a71d5d">===</span>&nbsp;<span style="color: #df5000">'index'</span><span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span>subject<span style="color: #000000">[</span>value<span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;be&nbsp;defined'</span><span style="color: #000000">);</span></div><div>&nbsp;&nbsp;<span style="color: #000000">}</span>&nbsp;<span style="color: #a71d5d">else</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span>subject<span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'to&nbsp;contain'</span><span style="color: #000000">,</span>&nbsp;value<span style="color: #000000">);</span></div><div>&nbsp;&nbsp;<span style="color: #000000">}</span></div><div><span style="color: #000000">});</span></div><div>&nbsp;</div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #df5000">'a'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'b'</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;have&nbsp;index'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">1</span><span style="color: #000000">);</span></div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #df5000">'a'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'b'</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;have&nbsp;value'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'b'</span><span style="color: #000000">);</span></div></pre>

<h2 id="flags">Flags</h2>
<p>Flags allow assertions to define modifiers which can alter the behaviour of the assertion.
The most common example is the <code>not</code> flag which requests that the assertion be negated,
which makes the following possible:</p>
<pre class="code lang-javascript"><div>expect<span style="color: #000000">.</span><span style="color: #000000">addAssertion</span><span style="color: #000000">(</span><span style="color: #df5000">'&lt;array&gt;&nbsp;[not]&nbsp;to&nbsp;have&nbsp;item&nbsp;&lt;any&gt;'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span></div><div>&nbsp;&nbsp;expect<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;subject<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;value</div><div><span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;<span style="color: #a71d5d">if</span>&nbsp;<span style="color: #000000">(</span>expect<span style="color: #000000">.</span>flags<span style="color: #000000">.</span>not<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span>subject<span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'not&nbsp;to&nbsp;contain'</span><span style="color: #000000">,</span>&nbsp;value<span style="color: #000000">);</span></div><div>&nbsp;&nbsp;<span style="color: #000000">}</span>&nbsp;<span style="color: #a71d5d">else</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span>subject<span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'to&nbsp;contain'</span><span style="color: #000000">,</span>&nbsp;value<span style="color: #000000">);</span></div><div>&nbsp;&nbsp;<span style="color: #000000">}</span></div><div><span style="color: #000000">});</span></div><div>&nbsp;</div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;have&nbsp;item'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">);</span></div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'not&nbsp;to&nbsp;have&nbsp;item'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">4</span><span style="color: #000000">);</span></div></pre>

<p>Flags are made available to the handler function as an <code>expect.flags</code> object,
where the keys are the names of the flags and the values are <code>true</code>, if the flag
is used, or otherwise <code>undefined</code>.</p>
<p>This example could be improved further. Since
<a href="../../assertions/array-like/to-contain/">to contain</a> also supports the <code>not</code>
flag, one can propagate the flag to that assertion as follows:</p>
<pre class="code lang-javascript"><div>expect<span style="color: #000000">.</span><span style="color: #000000">addAssertion</span><span style="color: #000000">(</span><span style="color: #df5000">'&lt;array&gt;&nbsp;[not]&nbsp;to&nbsp;have&nbsp;item&nbsp;&lt;any&gt;'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span></div><div>&nbsp;&nbsp;expect<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;subject<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;value</div><div><span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span>subject<span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'[not]&nbsp;to&nbsp;contain'</span><span style="color: #000000">,</span>&nbsp;value<span style="color: #000000">);</span></div><div><span style="color: #000000">});</span></div></pre>

<p>In this way, when <code>to have item</code> is invoked with the <code>not</code> flag, that flag will
be passed along to <code>to contain</code>.</p>
<p>When flags are propagated, one can also invert the flag. This means that if
<code>to have item</code> is invoked with the <code>not</code> flag, it will be negated and the
<code>to contain</code> assertion will execute without it:</p>
<pre class="code lang-javascript"><div>expect<span style="color: #000000">.</span><span style="color: #000000">addAssertion</span><span style="color: #000000">(</span><span style="color: #df5000">'&lt;array&gt;&nbsp;[not]&nbsp;to&nbsp;have&nbsp;item&nbsp;&lt;any&gt;'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span></div><div>&nbsp;&nbsp;expect<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;subject<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;value</div><div><span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span>subject<span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'[!not]&nbsp;to&nbsp;contain'</span><span style="color: #000000">,</span>&nbsp;value<span style="color: #000000">);</span></div><div><span style="color: #000000">});</span></div><div>&nbsp;</div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'not&nbsp;to&nbsp;have&nbsp;item'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">);</span></div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;have&nbsp;item'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">4</span><span style="color: #000000">);</span></div></pre>

<p>Fun with flags, right? Flags can also be used to define optional filler words
that make an assertion read better:</p>
<pre class="code lang-javascript"><div>expect<span style="color: #000000">.</span><span style="color: #000000">addAssertion</span><span style="color: #000000">(</span><span style="color: #df5000">'&lt;array&gt;&nbsp;to&nbsp;have&nbsp;[this]&nbsp;item&nbsp;&lt;any&gt;'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span></div><div>&nbsp;&nbsp;expect<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;subject<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;value</div><div><span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span>subject<span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'to&nbsp;contain'</span><span style="color: #000000">,</span>&nbsp;value<span style="color: #000000">);</span></div><div><span style="color: #000000">});</span></div><div>&nbsp;</div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;have&nbsp;item'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">);</span></div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;have&nbsp;this&nbsp;item'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">);</span></div></pre>

<h2 id="optional-values">Optional values</h2>
<p>Assertions where a value is optional can be defined by adding a <code>?</code> after the
value&#39;s type definition. For instance, this can be used to define optional
<code>function</code> values:</p>
<pre class="code lang-javascript"><div><span style="color: #a71d5d">const</span>&nbsp;errorMode&nbsp;<span style="color: #a71d5d">=</span>&nbsp;<span style="color: #df5000">'default'</span><span style="color: #000000">;</span>&nbsp;<span style="color: #969896">//&nbsp;use&nbsp;to&nbsp;control&nbsp;the&nbsp;error&nbsp;mode&nbsp;in&nbsp;later&nbsp;examples</span></div><div>expect<span style="color: #000000">.</span><span style="color: #000000">addAssertion</span><span style="color: #000000">(</span></div><div>&nbsp;&nbsp;<span style="color: #df5000">'&lt;array&gt;&nbsp;[not]&nbsp;to&nbsp;be&nbsp;(sorted|ordered)&nbsp;[by]&nbsp;&lt;function?&gt;'</span><span style="color: #000000">,</span></div><div>&nbsp;&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span>expect<span style="color: #000000">,</span>&nbsp;subject<span style="color: #000000">,</span>&nbsp;cmp<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;expect<span style="color: #000000">.</span>errorMode&nbsp;<span style="color: #a71d5d">=</span>&nbsp;errorMode<span style="color: #000000">;</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span>subject<span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'[not]&nbsp;to&nbsp;equal'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #000000">[].</span><span style="color: #000000">concat</span><span style="color: #000000">(</span>subject<span style="color: #000000">).</span><span style="color: #000000">sort</span><span style="color: #000000">(</span>cmp<span style="color: #000000">));</span></div><div>&nbsp;&nbsp;<span style="color: #000000">}</span></div><div><span style="color: #000000">);</span></div></pre>

<p>Which can then be used as follows:</p>
<pre class="code lang-javascript"><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;be&nbsp;sorted'</span><span style="color: #000000">);</span></div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;be&nbsp;ordered'</span><span style="color: #000000">);</span></div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'not&nbsp;to&nbsp;be&nbsp;sorted'</span><span style="color: #000000">);</span></div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'not&nbsp;to&nbsp;be&nbsp;ordered'</span><span style="color: #000000">);</span></div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">3</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">1</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;be&nbsp;sorted'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span>x<span style="color: #000000">,</span>&nbsp;y<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;<span style="color: #a71d5d">return</span>&nbsp;y&nbsp;<span style="color: #a71d5d">-</span>&nbsp;x<span style="color: #000000">;</span></div><div><span style="color: #000000">});</span></div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">3</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">1</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;be&nbsp;sorted&nbsp;by'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span>x<span style="color: #000000">,</span>&nbsp;y<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;<span style="color: #a71d5d">return</span>&nbsp;y&nbsp;<span style="color: #a71d5d">-</span>&nbsp;x<span style="color: #000000">;</span></div><div><span style="color: #000000">});</span></div></pre>

<h2 id="overriding-the-standard-error-message">Overriding the standard error message</h2>
<p>When you create a new assertion Unexpected will generate an error
message from the assertion text and the input arguments. In some cases
it can be preferable to tweak the output instead of creating
completely custom output using <a href="../fail/">expect.fail</a>.</p>
<p>You can override how the <code>subject</code> is displayed by providing a
<code>subjectOutput</code> for the specific assertion. You can also override the output of
the arguments by overriding parts of <code>argsOutput</code> or provide a
completely custom output for the arguments by setting <code>argsOutput</code> to
an output function on the assertion.</p>
<p>Here is a few examples:</p>
<pre class="code lang-javascript"><div>expect<span style="color: #000000">.</span><span style="color: #000000">addAssertion</span><span style="color: #000000">(</span><span style="color: #df5000">'&lt;number&gt;&nbsp;to&nbsp;be&nbsp;contained&nbsp;by&nbsp;&lt;number&gt;&nbsp;&lt;number&gt;'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span></div><div>&nbsp;&nbsp;expect<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;subject<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;start<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;finish</div><div><span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;expect<span style="color: #000000">.</span><span style="color: #000000">subjectOutput</span>&nbsp;<span style="color: #a71d5d">=</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span>output<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #000000">.</span><span style="color: #000000">text</span><span style="color: #000000">(</span><span style="color: #df5000">'point&nbsp;'</span><span style="color: #000000">).</span><span style="color: #000000">jsNumber</span><span style="color: #000000">(</span>subject<span style="color: #000000">);</span></div><div>&nbsp;&nbsp;<span style="color: #000000">};</span></div><div>&nbsp;&nbsp;expect<span style="color: #000000">.</span><span style="color: #000000">argsOutput</span>&nbsp;<span style="color: #a71d5d">=</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span>output<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;output</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000">.</span><span style="color: #000000">text</span><span style="color: #000000">(</span><span style="color: #df5000">'interval&nbsp;'</span><span style="color: #000000">)</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000">.</span><span style="color: #000000">text</span><span style="color: #000000">(</span><span style="color: #df5000">'['</span><span style="color: #000000">)</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000">.</span><span style="color: #000000">appendInspected</span><span style="color: #000000">(</span>start<span style="color: #000000">)</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000">.</span><span style="color: #000000">text</span><span style="color: #000000">(</span><span style="color: #df5000">';'</span><span style="color: #000000">)</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000">.</span><span style="color: #000000">appendInspected</span><span style="color: #000000">(</span>finish<span style="color: #000000">)</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000">.</span><span style="color: #000000">text</span><span style="color: #000000">(</span><span style="color: #df5000">']'</span><span style="color: #000000">);</span></div><div>&nbsp;&nbsp;<span style="color: #000000">};</span></div><div>&nbsp;&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span>subject&nbsp;<span style="color: #a71d5d">&gt;=</span>&nbsp;start&nbsp;<span style="color: #a71d5d">&amp;&amp;</span>&nbsp;subject&nbsp;<span style="color: #a71d5d">&lt;=</span>&nbsp;finish<span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'[not]&nbsp;to&nbsp;be&nbsp;truthy'</span><span style="color: #000000">);</span></div><div><span style="color: #000000">});</span></div><div>&nbsp;</div><div><span style="color: #000000">expect</span><span style="color: #000000">(</span><span style="color: #0086b3">4</span><span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'to&nbsp;be&nbsp;contained&nbsp;by'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">8</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">10</span><span style="color: #000000">);</span></div></pre>

<pre class="output"><div><span style="color: red; font-weight: bold">expected</span>&nbsp;point&nbsp;<span style="color: #0086b3">4</span>&nbsp;<span style="color: red; font-weight: bold">to&nbsp;be&nbsp;contained&nbsp;by</span>&nbsp;interval&nbsp;[<span style="color: #0086b3">8</span>;<span style="color: #0086b3">10</span>]</div></pre>

<pre class="code lang-javascript"><div>expect<span style="color: #000000">.</span><span style="color: #000000">addAssertion</span><span style="color: #000000">(</span><span style="color: #df5000">'&lt;number&gt;&nbsp;to&nbsp;be&nbsp;similar&nbsp;to&nbsp;&lt;number&gt;&nbsp;&lt;number?&gt;'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span></div><div>&nbsp;&nbsp;expect<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;subject<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;value<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;epsilon</div><div><span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;<span style="color: #a71d5d">if</span>&nbsp;<span style="color: #000000">(</span><span style="color: #a71d5d">typeof</span>&nbsp;epsilon&nbsp;<span style="color: #a71d5d">!==</span>&nbsp;<span style="color: #df5000">'number'</span><span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;epsilon&nbsp;<span style="color: #a71d5d">=</span>&nbsp;<span style="color: #0086b3">1e-9</span><span style="color: #000000">;</span></div><div>&nbsp;&nbsp;<span style="color: #000000">}</span></div><div>&nbsp;&nbsp;expect<span style="color: #000000">.</span>argsOutput<span style="color: #000000">[</span><span style="color: #0086b3">2</span><span style="color: #000000">]</span>&nbsp;<span style="color: #a71d5d">=</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span>output<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #000000">.</span><span style="color: #000000">text</span><span style="color: #000000">(</span><span style="color: #df5000">'(epsilon:&nbsp;'</span><span style="color: #000000">).</span><span style="color: #000000">jsNumber</span><span style="color: #000000">(</span>epsilon<span style="color: #000000">.</span><span style="color: #000000">toExponential</span><span style="color: #000000">()).</span><span style="color: #000000">text</span><span style="color: #000000">(</span><span style="color: #df5000">')'</span><span style="color: #000000">);</span></div><div>&nbsp;&nbsp;<span style="color: #000000">};</span></div><div>&nbsp;&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span>Math<span style="color: #000000">.</span><span style="color: #000000">abs</span><span style="color: #000000">(</span>subject&nbsp;<span style="color: #a71d5d">-</span>&nbsp;value<span style="color: #000000">),</span>&nbsp;<span style="color: #df5000">'to&nbsp;be&nbsp;less&nbsp;than&nbsp;or&nbsp;equal&nbsp;to'</span><span style="color: #000000">,</span>&nbsp;epsilon<span style="color: #000000">);</span></div><div><span style="color: #000000">});</span></div><div>&nbsp;</div><div><span style="color: #000000">expect</span><span style="color: #000000">(</span><span style="color: #0086b3">4</span><span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'to&nbsp;be&nbsp;similar&nbsp;to'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">4.0001</span><span style="color: #000000">);</span></div></pre>

<pre class="output"><div><span style="color: red; font-weight: bold">expected</span>&nbsp;<span style="color: #0086b3">4</span>&nbsp;<span style="color: red; font-weight: bold">to&nbsp;be&nbsp;similar&nbsp;to</span>&nbsp;<span style="color: #0086b3">4.0001</span>,&nbsp;(epsilon:&nbsp;<span style="color: #0086b3">1e-9</span>)</div></pre>

<h2 id="controlling-the-output-of-nested-expects">Controlling the output of nested expects</h2>
<p>When a call to <code>expect</code> fails inside your assertion the standard error
message for the custom assertion will be used. In the case of our
<em>sorted</em> assertion fails, the output will be:</p>
<pre class="code lang-javascript"><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">4</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;be&nbsp;sorted'</span><span style="color: #000000">);</span></div></pre>

<pre class="output"><div><span style="color: red; font-weight: bold">expected</span>&nbsp;[&nbsp;<span style="color: #0086b3">1</span>,&nbsp;<span style="color: #0086b3">3</span>,&nbsp;<span style="color: #0086b3">2</span>,&nbsp;<span style="color: #0086b3">4</span>&nbsp;]&nbsp;<span style="color: red; font-weight: bold">to&nbsp;be&nbsp;sorted</span></div><div>&nbsp;</div><div>[</div><div><div style="display: inline-block; vertical-align: top"><div>&nbsp;</div><div>┌─▷</div><div>│</div><div>└──</div></div><div style="display: inline-block; vertical-align: top"><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">1</span>,</div></div></div></div></div><div>&nbsp;</div><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">3</span>,</div></div></div></div></div><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">2</span>,&nbsp;<span style="color: red; font-weight: bold">//&nbsp;should&nbsp;be&nbsp;moved</span></div></div></div><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">4</span></div></div></div></div></div></div></div><div>]</div></pre>

<p>We can control the output of the nested expects by changing the
<code>expect.errorMode</code> property.</p>
<p>The <em>bubble</em> error mode will hoist the next level error message to this level.</p>
<p>If we change the error mode to <em>bubble</em>, we get the following output:</p>
<pre class="code lang-javascript"><div>errorMode&nbsp;<span style="color: #a71d5d">=</span>&nbsp;<span style="color: #df5000">'bubble'</span><span style="color: #000000">;</span></div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">4</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;be&nbsp;sorted'</span><span style="color: #000000">);</span></div></pre>

<pre class="output"><div><span style="color: red; font-weight: bold">expected</span>&nbsp;[&nbsp;<span style="color: #0086b3">1</span>,&nbsp;<span style="color: #0086b3">3</span>,&nbsp;<span style="color: #0086b3">2</span>,&nbsp;<span style="color: #0086b3">4</span>&nbsp;]&nbsp;<span style="color: red; font-weight: bold">to&nbsp;equal</span>&nbsp;[&nbsp;<span style="color: #0086b3">1</span>,&nbsp;<span style="color: #0086b3">2</span>,&nbsp;<span style="color: #0086b3">3</span>,&nbsp;<span style="color: #0086b3">4</span>&nbsp;]</div><div>&nbsp;</div><div>[</div><div><div style="display: inline-block; vertical-align: top"><div>&nbsp;</div><div>┌─▷</div><div>│</div><div>└──</div></div><div style="display: inline-block; vertical-align: top"><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">1</span>,</div></div></div></div></div><div>&nbsp;</div><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">3</span>,</div></div></div></div></div><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">2</span>,&nbsp;<span style="color: red; font-weight: bold">//&nbsp;should&nbsp;be&nbsp;moved</span></div></div></div><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">4</span></div></div></div></div></div></div></div><div>]</div></pre>

<p>In the <em>nested</em> error mode the next level error message is included and
indented underneath the standard error message.</p>
<p>If we change the error mode to <em>nested</em>, we get the following output:</p>
<pre class="code lang-javascript"><div>errorMode&nbsp;<span style="color: #a71d5d">=</span>&nbsp;<span style="color: #df5000">'nested'</span><span style="color: #000000">;</span></div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">4</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;be&nbsp;sorted'</span><span style="color: #000000">);</span></div></pre>

<pre class="output"><div><span style="color: red; font-weight: bold">expected</span>&nbsp;[&nbsp;<span style="color: #0086b3">1</span>,&nbsp;<span style="color: #0086b3">3</span>,&nbsp;<span style="color: #0086b3">2</span>,&nbsp;<span style="color: #0086b3">4</span>&nbsp;]&nbsp;<span style="color: red; font-weight: bold">to&nbsp;be&nbsp;sorted</span></div><div>&nbsp;&nbsp;<div style="display: inline-block; vertical-align: top"><div><span style="color: red; font-weight: bold">expected</span>&nbsp;[&nbsp;<span style="color: #0086b3">1</span>,&nbsp;<span style="color: #0086b3">3</span>,&nbsp;<span style="color: #0086b3">2</span>,&nbsp;<span style="color: #0086b3">4</span>&nbsp;]&nbsp;<span style="color: red; font-weight: bold">to&nbsp;equal</span>&nbsp;[&nbsp;<span style="color: #0086b3">1</span>,&nbsp;<span style="color: #0086b3">2</span>,&nbsp;<span style="color: #0086b3">3</span>,&nbsp;<span style="color: #0086b3">4</span>&nbsp;]</div><div>&nbsp;</div><div>[</div><div><div style="display: inline-block; vertical-align: top"><div>&nbsp;</div><div>┌─▷</div><div>│</div><div>└──</div></div><div style="display: inline-block; vertical-align: top"><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">1</span>,</div></div></div></div></div><div>&nbsp;</div><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">3</span>,</div></div></div></div></div><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">2</span>,&nbsp;<span style="color: red; font-weight: bold">//&nbsp;should&nbsp;be&nbsp;moved</span></div></div></div><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">4</span></div></div></div></div></div></div></div><div>]</div></div></div></pre>

<p>The <em>defaultOrNested</em> error mode uses the default mode if the error chain contains a diff;
otherwise it the <em>nested</em> error mode will be used.</p>
<p>If we change the error mode to <em>defaultOrNested</em>, we get the following output:</p>
<pre class="code lang-javascript"><div>errorMode&nbsp;<span style="color: #a71d5d">=</span>&nbsp;<span style="color: #df5000">'defaultOrNested'</span><span style="color: #000000">;</span></div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">4</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;be&nbsp;sorted'</span><span style="color: #000000">);</span></div></pre>

<pre class="output"><div><span style="color: red; font-weight: bold">expected</span>&nbsp;[&nbsp;<span style="color: #0086b3">1</span>,&nbsp;<span style="color: #0086b3">3</span>,&nbsp;<span style="color: #0086b3">2</span>,&nbsp;<span style="color: #0086b3">4</span>&nbsp;]&nbsp;<span style="color: red; font-weight: bold">to&nbsp;be&nbsp;sorted</span></div><div>&nbsp;</div><div>[</div><div><div style="display: inline-block; vertical-align: top"><div>&nbsp;</div><div>┌─▷</div><div>│</div><div>└──</div></div><div style="display: inline-block; vertical-align: top"><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">1</span>,</div></div></div></div></div><div>&nbsp;</div><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">3</span>,</div></div></div></div></div><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">2</span>,&nbsp;<span style="color: red; font-weight: bold">//&nbsp;should&nbsp;be&nbsp;moved</span></div></div></div><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">4</span></div></div></div></div></div></div></div><div>]</div></pre>

<p>In the <em>diff</em> error mode will hoist the first found diff as the error message.
If no diff is present, it will fall back to the <em>default</em> error mode.</p>
<p>If we change the error mode to <em>diff</em>, we get the following output:</p>
<pre class="code lang-javascript"><div>errorMode&nbsp;<span style="color: #a71d5d">=</span>&nbsp;<span style="color: #df5000">'diff'</span><span style="color: #000000">;</span></div><div><span style="color: #000000">expect</span><span style="color: #000000">([</span><span style="color: #0086b3">1</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">3</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">2</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">4</span><span style="color: #000000">],</span>&nbsp;<span style="color: #df5000">'to&nbsp;be&nbsp;sorted'</span><span style="color: #000000">);</span></div></pre>

<pre class="output"><div>[</div><div><div style="display: inline-block; vertical-align: top"><div>&nbsp;</div><div>┌─▷</div><div>│</div><div>└──</div></div><div style="display: inline-block; vertical-align: top"><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">1</span>,</div></div></div></div></div><div>&nbsp;</div><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">3</span>,</div></div></div></div></div><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">2</span>,&nbsp;<span style="color: red; font-weight: bold">//&nbsp;should&nbsp;be&nbsp;moved</span></div></div></div><div>&nbsp;<div style="display: inline-block; vertical-align: top"><div><div style="display: inline-block; vertical-align: top"><div><span style="color: #0086b3">4</span></div></div></div></div></div></div></div><div>]</div></pre>

<h2 id="asynchronous-assertions">Asynchronous assertions</h2>
<p>Unexpected comes with built-in support for asynchronous
assertions. You basically just return a promise from the assertion.</p>
<p>For the purpose of explaining how we can make an asynchronous
assertion we will define a silly type which contains a
value that can only be retrieved after a delay:</p>
<pre class="code lang-javascript"><div><span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">Timelock</span><span style="color: #000000">(</span>value<span style="color: #000000">,</span>&nbsp;delay<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;<span style="color: #a71d5d">this</span><span style="color: #000000">.</span>value&nbsp;<span style="color: #a71d5d">=</span>&nbsp;value<span style="color: #000000">;</span></div><div>&nbsp;&nbsp;<span style="color: #a71d5d">this</span><span style="color: #000000">.</span>delay&nbsp;<span style="color: #a71d5d">=</span>&nbsp;delay<span style="color: #000000">;</span></div><div><span style="color: #000000">}</span></div><div>&nbsp;</div><div>Timelock<span style="color: #000000">.</span>prototype<span style="color: #000000">.</span><span style="color: #000000">getValue</span>&nbsp;<span style="color: #a71d5d">=</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span>cb<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;<span style="color: #a71d5d">const</span>&nbsp;that&nbsp;<span style="color: #a71d5d">=</span>&nbsp;<span style="color: #a71d5d">this</span><span style="color: #000000">;</span></div><div>&nbsp;&nbsp;<span style="color: #000000">setTimeout</span><span style="color: #000000">(</span><span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">()</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000">cb</span><span style="color: #000000">(</span>that<span style="color: #000000">.</span>value<span style="color: #000000">);</span></div><div>&nbsp;&nbsp;<span style="color: #000000">},</span>&nbsp;<span style="color: #a71d5d">this</span><span style="color: #000000">.</span>delay<span style="color: #000000">);</span></div><div><span style="color: #000000">};</span></div></pre>

<p>It would be pretty nice if we could use
<a href="../../assertions/any/to-satisfy/">to satisfy</a> on the value of a <code>Timelock</code>,
even if the retrieval is delayed. Then we would be able to do stuff
like this:</p>
<pre class="code lang-javascript"><div><span style="color: #a71d5d">return</span>&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span></div><div>&nbsp;&nbsp;<span style="color: #a71d5d">new</span>&nbsp;Timelock<span style="color: #000000">(</span><span style="color: #df5000">'Hello&nbsp;world'</span><span style="color: #000000">),</span></div><div>&nbsp;&nbsp;<span style="color: #df5000">'to&nbsp;satisfy'</span><span style="color: #000000">,</span></div><div>&nbsp;&nbsp;expect<span style="color: #000000">.</span><span style="color: #000000">it</span><span style="color: #000000">(</span><span style="color: #df5000">'have&nbsp;length'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">11</span><span style="color: #000000">)</span></div><div><span style="color: #000000">);</span></div></pre>

<p>First we need to define a <a href="../addType/">type</a> for handling the <code>Timelock</code>:</p>
<pre class="code lang-javascript"><div>expect<span style="color: #000000">.</span><span style="color: #000000">addType</span><span style="color: #000000">({</span></div><div>&nbsp;&nbsp;name<span style="color: #a71d5d">:</span>&nbsp;<span style="color: #df5000">'Timelock'</span><span style="color: #000000">,</span></div><div>&nbsp;&nbsp;<span style="color: #000000">identify</span><span style="color: #a71d5d">:</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span>value<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #a71d5d">return</span>&nbsp;value&nbsp;<span style="color: #a71d5d">&amp;&amp;</span>&nbsp;value&nbsp;<span style="color: #a71d5d">instanceof</span>&nbsp;Timelock<span style="color: #000000">;</span></div><div>&nbsp;&nbsp;<span style="color: #000000">},</span></div><div>&nbsp;&nbsp;<span style="color: #000000">inspect</span><span style="color: #a71d5d">:</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span>value<span style="color: #000000">,</span>&nbsp;depth<span style="color: #000000">,</span>&nbsp;output<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #000000">.</span><span style="color: #000000">jsFunctionName</span><span style="color: #000000">(</span><span style="color: #df5000">'Timelock'</span><span style="color: #000000">);</span></div><div>&nbsp;&nbsp;<span style="color: #000000">},</span></div><div><span style="color: #000000">});</span></div><div>&nbsp;</div><div>expect<span style="color: #000000">.</span><span style="color: #000000">addAssertion</span><span style="color: #000000">(</span><span style="color: #df5000">'&lt;Timelock&gt;&nbsp;to&nbsp;satisfy&nbsp;&lt;any&gt;'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span></div><div>&nbsp;&nbsp;expect<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;subject<span style="color: #000000">,</span></div><div>&nbsp;&nbsp;spec</div><div><span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;<span style="color: #a71d5d">return</span>&nbsp;expect<span style="color: #000000">.</span><span style="color: #000000">promise</span><span style="color: #000000">(</span><span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span>run<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;subject<span style="color: #000000">.</span><span style="color: #000000">getValue</span><span style="color: #000000">(</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000">run</span><span style="color: #000000">(</span><span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span>value<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #a71d5d">return</span>&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span>value<span style="color: #000000">,</span>&nbsp;<span style="color: #df5000">'to&nbsp;satisfy'</span><span style="color: #000000">,</span>&nbsp;spec<span style="color: #000000">);</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000">})</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000">);</span></div><div>&nbsp;&nbsp;<span style="color: #000000">});</span></div><div><span style="color: #000000">});</span></div></pre>

<p>Let&#39;s see how it works:</p>
<pre class="code lang-javascript"><div><span style="color: #a71d5d">return</span>&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span></div><div>&nbsp;&nbsp;<span style="color: #a71d5d">new</span>&nbsp;Timelock<span style="color: #000000">(</span><span style="color: #df5000">'Hello&nbsp;world!'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #0086b3">5</span><span style="color: #000000">),</span></div><div>&nbsp;&nbsp;<span style="color: #df5000">'to&nbsp;satisfy'</span><span style="color: #000000">,</span></div><div>&nbsp;&nbsp;expect<span style="color: #000000">.</span><span style="color: #000000">it</span><span style="color: #000000">(</span><span style="color: #df5000">'not&nbsp;to&nbsp;match'</span><span style="color: #000000">,</span>&nbsp;<span style="color: #183691">/!/</span><span style="color: #000000">)</span></div><div><span style="color: #000000">);</span></div></pre>

<pre class="output"><div><span style="color: red; font-weight: bold">expected</span>&nbsp;<span style="color: #795da3">Timelock</span>&nbsp;<span style="color: red; font-weight: bold">to&nbsp;satisfy</span>&nbsp;expect.it(<span style="color: #df5000">'not&nbsp;to&nbsp;match'</span>,&nbsp;<span style="color: #183691">/!/</span>)</div><div>&nbsp;</div><div><div style="display: inline-block; vertical-align: top"><div><span style="color: red; font-weight: bold">expected</span>&nbsp;<span style="color: #df5000">'Hello&nbsp;world!'</span>&nbsp;<span style="color: red; font-weight: bold">not&nbsp;to&nbsp;match</span>&nbsp;<span style="color: #183691">/!/</span></div><div>&nbsp;</div><div>Hello&nbsp;world<span style="background-color: red; color: white">!</span></div></div></div></pre>

<p>The best resource for learning more about custom assertions is to look
at how the predefined assertions are built:</p>
<p><a href="https://github.com/unexpectedjs/unexpected/blob/master/lib/assertions.js">lib/assertions.js</a></p>

        </div>
    </div>
</section>
<script type="text/javascript">
    baseUrl = '../..';
</script>
<script type="text/javascript" src="../../static/toggleSidebar.js"></script>
<script type="text/javascript" src="../../static/rememberScrollPosition.js"></script>
<script type="text/javascript" src="../../static/focusMain.js"></script>
<script type="text/javascript" src="../../static/search.js"></script>
</body>
</html>

